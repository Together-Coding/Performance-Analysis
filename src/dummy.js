export const words = (`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla porttitor quam urna, luctus sodales velit rhoncus id. Sed tincidunt eleifend ante, non aliquet magna pharetra nec. Maecenas ornare euismod ligula, in bibendum erat facilisis et. Cras in libero augue. Donec non ipsum sit amet enim tristique fringilla at rhoncus lorem. Curabitur feugiat tempor urna ullamcorper vestibulum. Fusce ut dui sed libero efficitur scelerisque nec sed ante. Cras lectus est, fringilla at nunc vitae, congue tempor leo. Aenean lacinia in nunc ac tincidunt. Mauris blandit nisl et velit feugiat, quis suscipit diam porttitor. Nunc blandit turpis quis orci tincidunt, et venenatis diam sollicitudin. Donec feugiat aliquet urna, id sodales orci ultrices in. Duis interdum, magna vitae sagittis ultrices, magna massa consequat sem, in tincidunt felis lacus at nunc.

Donec finibus turpis sit amet orci tempor, scelerisque rhoncus nunc gravida. Vestibulum iaculis imperdiet odio ut lacinia. Nulla varius tempus ligula, in ultricies lectus porttitor a. Integer in leo eget lorem aliquet convallis. Sed eget dolor mi. Nulla viverra dolor id nunc aliquam, ut bibendum lectus consectetur. Fusce sollicitudin nulla nisi, et feugiat nisi lacinia id. Fusce fringilla vulputate elit nec luctus. Mauris ligula justo, rutrum quis tellus sed, pretium imperdiet purus. Nunc consequat justo efficitur auctor egestas. Cras placerat nunc tellus, eget hendrerit dolor congue in. Curabitur elementum elit molestie ex pharetra vestibulum.

Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Nam tincidunt libero magna, condimentum pharetra justo interdum quis. Integer lobortis efficitur arcu. Duis a lorem viverra, ultricies nulla placerat, tempus tellus. Integer lacus libero, dignissim sed volutpat sit amet, mattis non lorem. Proin vitae pharetra sem, ac imperdiet felis. Vestibulum accumsan porttitor eleifend. Vivamus rutrum arcu at orci finibus, in sagittis risus pharetra. Nulla ac massa rutrum, ultricies ipsum sit amet, iaculis quam. Sed eget risus lectus. In ut euismod ante. Etiam sed dignissim dolor, non porttitor lorem. Donec pellentesque massa quis dui varius, eget tempus ante laoreet. Nunc sed sodales est. Donec tincidunt efficitur felis.

In non ante ac velit fermentum pellentesque in vitae mauris. Ut non luctus ligula, eget lobortis lorem. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Quisque urna tellus, aliquet vitae elementum nec, pharetra ut tortor. Cras lacinia accumsan commodo. Curabitur at velit ultrices, tincidunt elit sed, sagittis tortor. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

Nam consequat volutpat est, tempus euismod ligula feugiat in. Curabitur faucibus ullamcorper orci, eget efficitur ligula fermentum sit amet. Donec venenatis nibh at ultricies auctor. Sed interdum, arcu eu pretium blandit, augue enim maximus nulla, ac consequat turpis turpis fringilla est. Nunc nec purus ac massa placerat condimentum sit amet vel massa. Sed magna quam, imperdiet vel laoreet a, pellentesque faucibus mi. Proin at ipsum sed tellus dignissim faucibus sed in sapien.

Quisque convallis rhoncus ligula eu placerat. Aenean laoreet sapien mi, molestie tincidunt nunc lobortis ac. In id tellus quis mi faucibus porta non quis eros. Proin ante diam, mattis ut mattis in, tristique a purus. Maecenas lobortis consequat sagittis. Sed maximus ante sed turpis suscipit tincidunt. Duis tempor, arcu ut efficitur eleifend, velit orci scelerisque velit, id viverra leo nibh in turpis. Donec ut faucibus justo. Proin finibus elementum sem, in dignissim nisi suscipit in. Sed posuere diam a leo blandit, sit amet laoreet sem rutrum.

Etiam porttitor tellus consectetur magna mattis, sit amet gravida eros tempus. Vivamus fermentum ornare ligula quis placerat. Nullam in metus ut dolor consequat sollicitudin. Fusce viverra egestas velit, nec consequat dui tincidunt vitae. Donec eget elit finibus, mollis lacus ac, faucibus diam. Etiam consectetur sollicitudin nisi. In tristique eros in mauris elementum, in ultricies nisl aliquam.

Cras vulputate tellus felis, non cursus tellus tincidunt eget. Suspendisse interdum quam in leo feugiat, nec tincidunt ex tincidunt. Aenean pellentesque enim vel est cursus eleifend. Cras eleifend justo est, quis mattis lacus lacinia non. Duis lacinia sem eget ligula imperdiet, sed pulvinar mauris molestie. Maecenas quis massa ullamcorper, dapibus nunc at, vulputate nisi. Proin malesuada pellentesque lobortis. Suspendisse potenti. Mauris ultricies dui ut sodales porta. Integer vestibulum eu dui sit amet interdum. Aliquam non eleifend leo, nec posuere neque. Phasellus congue diam non quam accumsan facilisis. Curabitur hendrerit sit amet elit id ullamcorper. Etiam tristique nunc et feugiat interdum. Maecenas finibus id risus sit amet suscipit. Curabitur dolor nisi, vulputate at diam ac, scelerisque tincidunt libero.

Nullam eu orci in augue lobortis porta. Morbi dictum convallis feugiat. Etiam aliquet justo id sem vestibulum tincidunt a quis nisl. Nulla erat augue, pellentesque ac vestibulum in, placerat in ipsum. Suspendisse hendrerit fermentum turpis, nec scelerisque ante ornare sit amet. Ut imperdiet nulla nisi, porta sollicitudin massa facilisis sed. Nam rutrum magna felis, in gravida felis consequat porttitor. Curabitur scelerisque mauris non lacus ultricies cursus. Aliquam erat volutpat. Duis varius quam nec augue auctor ornare. Nam nec faucibus quam. Proin at sapien augue. Mauris vulputate mauris ac augue sagittis, in porttitor mi lacinia. Donec consequat a leo in tincidunt. Vestibulum aliquam, elit in finibus ornare, lorem sem tempus turpis, sed posuere ipsum velit ac sem.

Mauris dignissim gravida volutpat. Aliquam iaculis nisi nunc, vitae volutpat enim vestibulum in. Nullam aliquet, dolor sit amet convallis rhoncus, ligula ante sagittis odio, vitae commodo sapien diam ac est. Nunc a pulvinar erat. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Fusce commodo placerat lectus eu congue. Nullam ac consequat est, et sagittis ligula. Suspendisse nec augue euismod, posuere ex eu, interdum erat. Nulla dictum, arcu ut hendrerit facilisis, nibh mauris fringilla sem, ut condimentum velit diam in lectus.

Quisque ac felis ipsum. Cras nec vestibulum dui. Maecenas faucibus justo id dui scelerisque, at lobortis leo fringilla. Sed posuere fringilla massa a consequat. Nulla ut mollis augue. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vitae diam ut ex euismod dapibus. Nam interdum suscipit tortor nec elementum. Mauris nec risus mi.

Vestibulum lorem diam, fermentum porttitor iaculis eget, finibus in justo. Praesent ac porta urna. Nam eget neque sed diam tempor tempus sit amet vel odio. Pellentesque faucibus elit ut eros finibus ultricies. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc dapibus, nunc a eleifend consectetur, ante erat viverra justo, in bibendum odio enim eu nibh. Suspendisse ut ante vel eros viverra placerat. Suspendisse gravida efficitur rutrum.

Praesent pretium diam vel lorem placerat faucibus. Curabitur ullamcorper dui a ipsum vestibulum eleifend. Donec leo ligula, sollicitudin eu dictum vitae, imperdiet id mauris. Proin vel vulputate eros. Cras tincidunt non sapien quis mollis. Pellentesque posuere efficitur odio, sagittis aliquam turpis commodo ac. Sed ac vestibulum mi, a mattis felis. Nunc vitae nisl lectus. Sed nunc magna, facilisis eget dolor et, scelerisque sodales odio. Nullam turpis orci, tristique non ultricies a, luctus ac quam.

Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Donec mollis ex id lorem scelerisque, ac volutpat sapien hendrerit. Ut viverra tortor pulvinar, eleifend felis eu, interdum quam. Sed tempus lobortis purus, nec posuere metus vehicula eu. Cras et arcu ultrices lorem varius ultricies. Sed diam magna, ultrices vitae fermentum sed, molestie vitae ante. Praesent sagittis non arcu eget lacinia. Cras nibh erat, tincidunt et ante non, facilisis sagittis tellus. Morbi id nibh vehicula, luctus ligula ac, consequat metus. Vivamus et vestibulum lorem.

Vivamus maximus posuere elit, nec feugiat velit faucibus vitae. Nunc iaculis felis quam, ut scelerisque diam luctus non. Nullam vitae rhoncus turpis. Praesent sit amet magna auctor, aliquam orci nec, suscipit mauris. Donec molestie eros at urna tempus, vitae fringilla ipsum lacinia. Nunc vehicula maximus purus ac varius. Mauris mauris arcu, mollis id sodales at, pharetra a mauris. Nunc consequat justo in quam faucibus, ac rutrum nunc finibus. In quis tellus metus. Duis sit amet diam sollicitudin, feugiat velit ac, iaculis elit. Nulla facilisi. Sed quis libero tincidunt, euismod elit sed, hendrerit magna. Quisque eu justo vitae nibh dapibus viverra eget ac ligula.

Aenean pulvinar consectetur leo, a vulputate sapien faucibus non. Integer a efficitur nunc. Maecenas nunc eros, vulputate non sem in, maximus pretium nisl. Praesent vestibulum augue id hendrerit varius. Mauris dignissim lacus non leo venenatis, non tincidunt dui suscipit. Vivamus eget lectus egestas, rhoncus nibh eget, accumsan libero. Ut dapibus vehicula dui a gravida. Curabitur dictum, nunc at eleifend interdum, leo mi pretium orci, at feugiat ligula augue vel leo. Donec a risus in elit congue convallis viverra molestie mi. Fusce nibh enim, pellentesque et auctor sit amet, ornare nec tortor. Fusce dignissim leo id tempus sollicitudin. Quisque egestas non augue a imperdiet. Nunc mattis a ante eu feugiat. Maecenas vulputate mauris a pulvinar lacinia.

Cras augue est, efficitur sodales tempor et, luctus in nisl. Donec vehicula auctor quam et posuere. Morbi mattis neque nibh, et vulputate quam varius at. Aliquam ut diam elit. Suspendisse ut velit velit. Pellentesque et pretium tellus. Curabitur placerat accumsan sollicitudin. Cras in suscipit felis, eu dignissim nulla.

Aliquam eget magna eget metus ultricies varius. Nam eget turpis eu purus accumsan auctor ut vel lacus. Phasellus a arcu augue. Quisque feugiat sit amet mi nec vestibulum. Duis suscipit odio turpis, eget rutrum eros rutrum at. Etiam semper elit at tellus semper, vel aliquet ligula fermentum. In ut justo leo. Proin pulvinar, lectus ut aliquam mattis, dolor dui mollis nibh, vulputate sagittis arcu enim quis nulla. Nulla posuere, magna et molestie lobortis, dui nunc consectetur lectus, at laoreet purus nisi vitae velit. Fusce eget commodo est. In tincidunt ante leo, sit amet accumsan nunc condimentum eu. Aliquam aliquam commodo erat, at luctus erat tempus nec. Morbi auctor purus in erat euismod placerat. Proin nisi lorem, finibus a velit non, hendrerit sagittis ex. Curabitur faucibus dignissim mi, efficitur ultricies enim gravida elementum.

Phasellus vehicula imperdiet nisi sit amet hendrerit. Cras feugiat faucibus sem, a auctor quam. Vivamus eget malesuada ante, sed vehicula dui. Donec sed ante velit. Suspendisse non luctus tortor. Donec sit amet tempor tortor. Praesent quis blandit metus, a fermentum nibh. Proin rhoncus egestas enim, in suscipit dolor interdum nec. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Maecenas sollicitudin purus lacus, at condimentum lectus interdum eu. Vivamus condimentum sit amet neque sed semper.

Donec lobortis venenatis quam in eleifend. Curabitur nec sem quis nisl eleifend consequat eget et justo. Sed interdum orci non nulla scelerisque, sit amet faucibus eros dapibus. Donec fringilla ex vitae justo tempor, consequat eleifend massa suscipit. In et consequat tellus, sit amet convallis eros. Integer varius quam molestie nulla finibus, sit amet rutrum ligula imperdiet. Cras rutrum arcu at orci faucibus porta. Donec viverra tincidunt neque sed ullamcorper. Curabitur felis ante, ornare ac lectus in, malesuada lobortis mi. Integer turpis augue, dignissim at lorem in, facilisis cursus augue. Maecenas tempor semper nulla, id consequat augue hendrerit quis.

Mauris eu tempor lacus. Sed maximus est ac iaculis pellentesque. Mauris dui diam, efficitur et neque quis, condimentum ornare nibh. Morbi iaculis fermentum felis sed lacinia. Etiam nec urna dapibus turpis aliquam iaculis. Sed quis est sem. Duis arcu magna, pharetra sit amet est id, consectetur placerat nibh. Sed non ultrices velit. Vestibulum consectetur magna metus, consequat malesuada tellus egestas rutrum. Suspendisse viverra ac leo vitae fermentum. Vestibulum justo felis, dignissim ac interdum ac, scelerisque quis quam. Nunc at lorem convallis, placerat ante at, euismod risus. Etiam fermentum egestas ipsum, id hendrerit leo condimentum et. Duis eros lectus, mollis non tempor ut, molestie vitae dolor. In quis tortor eget mi hendrerit consectetur.

Aenean ut nisi sed nisl faucibus lobortis. Aenean semper sapien lorem, sit amet dapibus nulla placerat in. Sed gravida ipsum arcu, et tempus lacus congue sed. Nam suscipit dapibus tincidunt. Vivamus vitae nibh urna. Morbi mattis scelerisque diam. Etiam elementum eleifend arcu, sit amet vulputate nisl dictum non. Praesent vel dolor sollicitudin, euismod diam eget, aliquet ipsum. Curabitur augue felis, hendrerit accumsan posuere eget, porta facilisis libero. Donec auctor urna ac fermentum venenatis. Vivamus sit amet tristique leo, eu commodo sapien. Interdum et malesuada fames ac ante ipsum primis in faucibus. Nulla consequat justo orci, id accumsan sem gravida et. Fusce nec porttitor est. Etiam nec pretium libero, sed convallis mauris.

Phasellus iaculis arcu in diam mollis ullamcorper. Mauris id orci a leo placerat consequat eget at magna. Interdum et malesuada fames ac ante ipsum primis in faucibus. Sed accumsan molestie vulputate. Nam nec enim efficitur, vulputate purus at, volutpat nisi. Nulla blandit eleifend iaculis. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Duis non iaculis diam. Sed dictum placerat turpis vel gravida. Donec posuere risus vel tellus porttitor, vel feugiat massa eleifend. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc fermentum est rutrum vestibulum lacinia. Sed id molestie dui, nec malesuada risus.

Etiam sed finibus nibh. Sed a ligula vel massa imperdiet facilisis fringilla quis nisi. Quisque id mauris metus. Phasellus varius, urna at sollicitudin fermentum, urna mi egestas purus, id dapibus velit sapien non lacus. Aenean et malesuada mauris. Nulla quis pharetra ex. Donec vulputate, dui non finibus rhoncus, nunc nulla ullamcorper sapien, at scelerisque diam lacus ac risus. Sed sit amet sem in dui iaculis tempus. Donec rhoncus tincidunt nisl et semper. Nunc at tincidunt tortor. Cras dictum justo et libero blandit, id feugiat eros dapibus. Etiam dignissim odio eget dolor faucibus, quis sagittis libero accumsan. Curabitur porta pharetra urna ut ornare. Mauris sollicitudin varius mattis.

Curabitur vitae tempor turpis. Nunc vel sem ut lacus condimentum pellentesque sed ac lacus. Praesent porttitor risus eu erat blandit accumsan. Curabitur eget purus molestie, imperdiet augue quis, molestie nulla. Nam vel commodo ante. Cras neque ligula, mollis non commodo a, tristique fermentum est. Proin ut fermentum elit, sit amet accumsan mauris. Sed orci orci, vehicula ac nisl et, maximus suscipit metus. Nam ex ligula, bibendum vel massa sit amet, fermentum interdum dolor. Fusce in nisi non felis convallis blandit. Aliquam hendrerit fermentum arcu, vitae ultricies odio molestie id. Morbi neque nulla, dignissim eget urna at, efficitur lobortis mauris. In semper pellentesque condimentum. Praesent ac scelerisque mauris.

Etiam at pulvinar tellus. Vestibulum arcu est, ornare id dignissim vitae, blandit et justo. Ut quis augue et augue euismod egestas. Maecenas bibendum egestas ullamcorper. Proin dapibus enim ipsum, non sodales magna consequat tincidunt. Nam nec felis urna. Integer placerat elit in nulla bibendum, quis consequat libero mattis. Aliquam pellentesque auctor elementum. Sed quis accumsan erat. Aenean maximus mauris vel ligula cursus venenatis. Phasellus sed ornare felis, in consequat erat. Nam elementum elementum est, sit amet luctus enim malesuada vitae.

Quisque justo diam, rutrum sed aliquam ut, tincidunt id odio. Mauris eleifend lacus at ligula auctor condimentum. Etiam venenatis, mi ornare porta ullamcorper, sapien ante dapibus orci, pharetra mattis neque nulla non nisl. In et erat at libero tempor sodales ut nec erat. Cras scelerisque magna ut neque elementum sollicitudin. Maecenas at odio dictum, porta sapien sit amet, scelerisque odio. Quisque gravida massa a commodo ullamcorper. Duis dignissim elit velit, ornare sollicitudin arcu sodales ac. Vivamus vehicula commodo tortor, tempus dignissim est accumsan in. Etiam posuere porttitor lacus. Aenean non malesuada purus.

Sed ac faucibus est. Integer in lobortis ante, at posuere nisl. Nullam molestie augue sit amet metus faucibus dapibus. Duis bibendum diam ut consectetur vestibulum. Aliquam nulla felis, tempus vel dignissim sed, hendrerit et urna. Sed maximus sagittis nunc, a ultrices metus condimentum sit amet. Integer et erat magna. Nam et lorem malesuada, malesuada metus ut, pellentesque enim. Sed sed metus at ligula tincidunt commodo. Mauris scelerisque sit amet sem ac placerat.

Morbi ac finibus felis. Nunc pharetra tincidunt odio, nec luctus turpis hendrerit suscipit. Suspendisse hendrerit viverra tincidunt. Proin sagittis metus vitae nisi ornare, nec sollicitudin tellus feugiat. Morbi diam orci, aliquam et pulvinar sit amet, fermentum efficitur ex. Curabitur eget tortor bibendum, suscipit ligula tincidunt, gravida massa. Nulla sapien libero, rhoncus sit amet dui sed, consequat maximus dolor. Nulla mollis nec odio sed mattis. Vivamus tincidunt hendrerit lobortis. Aenean rutrum sed nisi eu fringilla.

Nunc facilisis consectetur dui, sed lobortis ante facilisis id. Vestibulum varius leo nec sodales condimentum. Phasellus sit amet nunc mauris. Quisque et nunc convallis, fermentum ante non, varius nisi. Aenean imperdiet sagittis nunc, quis aliquam quam volutpat eu. Fusce sagittis, risus sit amet tincidunt semper, massa justo euismod nibh, sed pretium nunc quam sit amet dui. Nunc feugiat massa vel tempus ultricies. In pretium odio sit amet sem pharetra egestas.

Praesent fermentum, nibh tincidunt mattis facilisis, mi dui auctor nibh, laoreet pharetra purus nulla a justo. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed tincidunt id sem vitae finibus. Donec gravida maximus ipsum in varius. Proin vitae mollis massa. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Aenean porta quis magna id vehicula. Curabitur vitae metus ornare dolor luctus dignissim. Donec a metus libero. Mauris id vulputate massa. Mauris eget fermentum nisl, sed feugiat odio. In neque nunc, vulputate vel leo vitae, condimentum facilisis ligula. Nullam ut lectus ultrices, dapibus odio vel, vehicula tortor. Suspendisse a enim rutrum, efficitur mauris nec, bibendum nisl. Curabitur ac lorem ipsum.

Aliquam arcu neque, pharetra a viverra ac, egestas in odio. Ut nunc libero, congue ut neque a, ultrices scelerisque orci. Sed vestibulum dui consequat enim finibus, sit amet efficitur eros suscipit. Aenean maximus nibh non sapien condimentum varius. Suspendisse vestibulum gravida odio, in mattis quam luctus eu. Sed quam purus, facilisis a ex vitae, aliquet cursus erat. Integer gravida purus et molestie ultricies. Suspendisse congue sapien in viverra aliquam. Cras vulputate, tortor nec pharetra fermentum, ante dolor imperdiet sem, sed maximus nibh felis ac lacus. Suspendisse velit tortor, posuere id lorem a, posuere volutpat risus. Cras fringilla lorem vitae viverra laoreet. Vivamus facilisis, leo ac mattis mollis, libero lorem commodo metus, id interdum arcu leo vel felis. Mauris commodo feugiat purus, ac porta dui maximus non. Sed vitae dui semper, placerat tortor id, accumsan eros. Sed ornare semper ipsum et facilisis. Pellentesque at neque vitae velit viverra viverra.

Cras nec quam vitae enim rhoncus vestibulum et facilisis dolor. Curabitur cursus, augue ac ornare porta, libero dui ornare turpis, non ornare est tortor vehicula erat. Maecenas mollis, lacus.
`).replace(/(\s)+/g, ' ').split(' ');


export const codes = [
    `# https://github.com/a2tt/Flask-Sqlalchemy-Admin-Sample/blob/main/project/models/admin.py
import math

from dominate.tags import *

from sqlalchemy import func
from sqlalchemy.inspection import inspect
from sqlalchemy.sql.sqltypes import Integer, Float, Boolean, String, DateTime

from project.models.base import User, AdminAccessLog

from project import db
import settings


def is_dev():
    return settings.STAGE == 'dev'


class Widget:
    def __init__(self):
        self.value = ''

    def __html__(self):
        pass


class ImageWidget(Widget):
    def __init__(self):
        raise NotImplementedError


class TextAreaWidget(Widget):
    def __init__(self, name, rows, cols=None, placeholder=None, disabled=False):
        super().__init__()
        self.name = self.id = name
        self.rows = rows
        self.cols = cols
        self.placeholder = placeholder if placeholder else f'{name}을 입력하세요.'
        self.disabled = disabled

    def __html__(self):
        tag = textarea(str(self.value),
                       id=self.id,
                       name=self.name,
                       rows=self.rows,
                       placeholder=self.placeholder
                       )
        if self.cols:
            tag.set_attribute('cols', self.cols)
        if self.disabled:
            tag.set_attribute('disabled', True)
        return tag


class SelectWidget(Widget):
    def __init__(self, name, options=None):
        super().__init__()
        self.name = self.id = name
        if not options:
            self.options = {'True': 1, 'False': 0}
        else:
            self.options = options

    def __html__(self):
        tag = select(id=self.id, name=self.name)
        tag.add(option('-----', value='', disabled=True,
                       hidden=True, selected=True if not str(self.value) else False))
        for key, value in self.options.items():
            opt = option(key, value=value)
            if str(self.value) == key or self.value == key:
                opt.set_attribute('selected', 1)
            tag.add(opt)
        return tag


class Paginator:
    def __init__(self, total_rows, page, per_page):
        self.per_page = per_page
        self.pages = self.last_page = math.ceil(total_rows / per_page)
        self.page = page
        self.near_pages = list(filter(lambda p: 0 < p <= self.pages, range(page - 3, page + 4)))

    @property
    def has_next(self):
        return self.page < self.last_page

    @property
    def has_prev(self):
        return self.page > 1

    @property
    def prev_page(self):
        if self.has_prev:
            return self.page - 1
        return None

    @property
    def next_page(self):
        if self.has_next:
            return self.page + 1
        return None


class AdminModel:
    __tablename__ = None  # sqlalchemy.exc.NoForeignKeysError 방지

    per_page = 20
    __num_rows = None  # count(*)
    p_key = 'id'
    keys = []  # table rows
    list_display = []  # keys on list view
    search_keys = []  # 검색
    sort_keys = []  # sortable keys
    filter_keys = []  # filterable keys

    list_editable = []

    creatable = False
    editable = True
    deletable = False

    edit_role = User.ADMINS

    field_group = []  # detail view 에서 컬럼 그룹화

    class Meta:
        widgets = {}

    @classmethod
    def table_name(cls):
        return cls.__table__.name

    @classmethod
    def init(cls):
        cls.set_keys()
        cls.set_p_key()

    @classmethod
    def set_keys(cls):
        # cls.keys = inspect(cls).attrs.keys()  # backref 도 가져와버림. backref.type 값이 없어서 column_type 에서 에러
        cls.keys = cls.__table__.columns.keys()

    @classmethod
    def set_p_key(cls):
        ins = inspect(cls)
        cls.p_key = ins.primary_key[0].key

    @classmethod
    def num_rows(cls):
        """ 총 row 개수 """
        if not cls.__num_rows:
            return db.session.query(func.count(getattr(cls, cls.p_key))).scalar()
        else:  # ?? ... row 가 너무 많을 때 쓰려고 만든 것 같은데
            return cls.__num_rows

    @classmethod
    def get_column(cls, key):
        return getattr(cls, key)

    @classmethod
    def column_is_nullable(cls, key):
        column = cls.get_column(key)
        return column.nullable

    @classmethod
    def get_default_value(cls, key):
        column = cls.get_column(key)
        if not column:
            raise ValueError
        default = column.default
        if default:
            return default.arg
        return None

    @classmethod
    def column_type(cls, key, format_='py'):
        if type(getattr(cls, key)) == property:  # FIXME :(
            type_ = String
        else:
            column = cls.get_column(key)
            type_ = type(column.type)

        if format_ == 'py':
            if type_ == Integer:
                return 'int'
            elif type_ == Float:
                return 'float'
            elif type_ == Boolean:
                return 'bool'
            elif type_ == DateTime:
                return 'str'
            else:  # str
                return 'str'
        elif format_ == 'html':
            if type_ in [Integer, Float]:
                return 'number'
            elif type_ == DateTime:
                # return 'datetime-local'
                return 'text'
            else:
                return 'text'
        return type_

    @classmethod
    def pagination(cls, page, pp, q_key=None, q=None):
        try:
            queryset = (db.session.query(cls))
            if q_key and q:
                type_ = cls.column_type(q_key, format_='py')
                if type_ in ['int', 'float']:
                    queryset = queryset.filter(getattr(cls, q_key) == q)
                else:
                    queryset = queryset.filter(getattr(cls, q_key).contains(q))
            items = (queryset.order_by(getattr(cls, cls.p_key).desc())
                     .offset((page - 1) * pp)
                     .limit(pp)
                     .all())
            return items
        except Exception as e:
            db.session.rollback()
            print(e)
            return cls.pagination(page, pp, None, None)

    @classmethod
    def sort_pagination(cls, page, pp, args):
        try:
            queryset = (db.session.query(cls))

            for key, value in args.items():
                if key not in cls.keys:
                    continue
                if value in ['desc', 'asc']:
                    queryset = (queryset.filter(getattr(cls, key).isnot(None))
                                .order_by(getattr(getattr(cls, key), value)()))

            items = (queryset.order_by(getattr(cls, cls.p_key).desc())
                     .offset((page - 1) * pp)
                     .limit(pp)
                     .all())
            return items
        except Exception as e:
            db.session.rollback()
            print(e)
            return []

    @classmethod
    def filter_pagination(cls, page, pp, args):
        # TODO 범위 쿼리
        try:
            queryset = (db.session.query(cls))

            for key, value in args.items():
                if key not in cls.keys:
                    continue
                type_ = cls.column_type(key, format_='py')
                if type_ == 'bool':
                    value = True if value == '1' else False
                    queryset = (queryset.filter(getattr(cls, key).is_(value)))
                elif type_ in ['int', 'float']:
                    queryset = (queryset.filter(getattr(cls, key) == value))
                else:  # str, DateTime
                    queryset = (queryset.filter(getattr(cls, key) == value))

            items = (queryset.order_by(getattr(cls, cls.p_key).desc())
                     .offset((page - 1) * pp)
                     .limit(pp)
                     .all())
            return items
        except Exception as e:
            db.session.rollback()
            print(e)
            return []


class UserAdmin(AdminModel, User):
    list_display = ['id', 'name', 'is_active', 'created_at']
    search_keys = ['id', 'name', 'role']
    sort_keys = ['id', 'name', 'created_at']
    filter_keys = ['is_active', 'role']

    creatable = True
    list_editable = ['name', 'is_active']
    if is_dev():
        list_editable += ['role']
    edit_role = [User.SUPERUSER]

    field_group = [
        ['id', 'is_active'],
        [],
        ['name', 'role', 'created_at'],
    ]

    class Meta:
        widgets = {
            'is_active': SelectWidget(name='is_active'),
            'role': SelectWidget(name='role',
                                 options={0: 0, 32: 32, 64: 64, 128: 128}),
        }


class AdminAccessLogAdmin(AdminModel, AdminAccessLog):
    list_display = ['id', 'user_id', 'endpoint', 'created_at']
    editable = False


# list view 생성
models = {
    'User': [UserAdmin],
    'Base': [AdminAccessLogAdmin],
}

# if is_dev():  # privacy!
#     models['Play'].insert(1, UserAdmin)

# list view 생성 (invisible)
hidden_models = []

auto_detail_views = [  # create DetailView
    AdminAccessLogAdmin,
]

auto_update_views = [
    UserAdmin, AdminAccessLogAdmin,
]

auto_create_views = [
    UserAdmin, AdminAccessLogAdmin,
]
    \n`, `# https://github.com/a2tt/Flask-Sqlalchemy-Admin-Sample/blob/main/project/models/base.py
    import datetime

    from sqlalchemy import Column, types
    from sqlalchemy.ext.declarative import declarative_base, declared_attr

    from project.utils import *


    class DefaultBase(object):
        @declared_attr
        def __tablename__(cls):
            return camel_to_snake(cls.__name__)

        def __repr__(self):
            try:
                return f'{type(self).__name__} id={getattr(self, "id")}'
            except AttributeError:
                return f'{type(self).__name__}'


    Base = declarative_base(cls=DefaultBase)


    class User(Base):
        id = Column(types.Integer, autoincrement=True, nullable=False, primary_key=True)
        name = Column(types.String, nullable=False)
        role = Column(types.Integer, nullable=True)
        is_active = Column(types.Boolean, nullable=False, default=True)
        created_at = Column(types.DateTime, nullable=False, default=datetime.datetime.utcnow)

        ADMIN = 64
        SUPERUSER = 128
        ADMINS = [ADMIN, SUPERUSER]


    class AdminAccessLog(Base):
        id = Column(types.Integer, autoincrement=True, nullable=False, primary_key=True)
        user_id = Column(types.Integer, nullable=False)

        endpoint = Column(types.String, nullable=False)
        args = Column(types.String, nullable=True)
        form = Column(types.String, nullable=True)

        created_at = Column(types.DateTime, nullable=False, default=datetime.datetime.utcnow)
    \n`, `# https://github.com/a2tt/flask-oauth-example/blob/main/flask_server.py
    import time
    import requests
    from urllib.parse import urlencode

    from flask import Flask, request, url_for, jsonify, abort, redirect

    from oauth_config import oauth_config

    app = Flask(__name__)


    @app.route('/')
    @app.route('/login')
    def login():
        return f'''
        <h1>OAuth</h1>
        <h2><a href="{url_for('.oauth_login', provider='google')}">Google</a></h2>
        <h2><a href="{url_for('.oauth_login', provider='facebook')}">Facebook</a></h2>
        <h2><a href="{url_for('.oauth_login', provider='naver')}">Naver</a></h2>
        <h2><a href="{url_for('.oauth_login', provider='kakao')}">Kakao</a></h2>
        <h2><a href="{url_for('.oauth_login', provider='twitch')}">Twitch</a></h2>
        
        <h1>OIDC</h1>
        <h2><a href="{url_for('.oidc_login', provider='twitch')}">Twitch</a></h2>
        '''


    @app.route('/login/<provider>')
    def oauth_login(provider):
        try:
            auth_uri = oauth_config[provider]['auth_uri']
            params = oauth_config[provider]['auth_params']

            params.update({'state': str(time.time()),
                        'redirect_uri': url_for('.oauth_login_callback', provider=provider, _external=True)})
            qs = urlencode(params)

            login_url = auth_uri + '?' + qs
            return redirect(login_url)
        except KeyError:
            abort(404)


    @app.route('/login/<provider>/callback')
    def oauth_login_callback(provider):
        try:
            token_uri = oauth_config[provider]['token_uri']
            params = oauth_config[provider]['token_params']
            params.update({'code': request.args.get('code'),
                        'state': request.args.get('state', ''),
                        'scope': request.args.get('scope', ''),
                        'redirect_uri': url_for('.oauth_login_callback', provider=provider, _external=True)})

            resp = requests.post(token_uri, data=params)
            data = resp.json()

            return jsonify(data)
        except KeyError:
            abort(404)


    @app.route('/oauth/<provider>/me')
    def oauth_me(provider):
        access_token = request.args.get('access_token')
        headers = {'Authorization': f'Bearer {access_token}'}
        try:
            me_uri = oauth_config[provider]['me_uri']
            resp = requests.get(me_uri, headers=headers)
            me_resp = resp.json()
            return jsonify(me_resp)
        except KeyError:
            abort(404)


    @app.route('/login/oidc/<provider>')
    def oidc_login(provider):
        try:
            auth_uri = oauth_config[provider]['auth_uri']
            params = {
                # 'response_type': 'token+id_token',
                'response_type': 'token',
                'client_id': oauth_config[provider]['token_params']['client_id'],
                'redirect_uri': url_for('oidc_login_callback', provider=provider, _external=True),
                'scope': '+'.join(['openid'])
            }

            login_url = auth_uri + '?' + '&'.join([f'{k}={v}' for k, v in params.items()])
            return redirect(login_url)
        except KeyError:
            abort(404)


    @app.route('/login/oidc/<provider>/callback')
    def oidc_login_callback(provider):
        print(request.url)
        print(request.pragma)
        print(request.full_path)
        print(request.path)

        return str(request.url)


    if __name__ == '__main__':
        app.run(debug=True)
    \n`, `# https://github.com/a2tt/flask-oauth-example/blob/main/oauth_config.py
    """
    google https://developers.google.com/identity/protocols/OAuth2WebServer
    naver https://developers.naver.com/docs/login/api/
    kakao https://developers.kakao.com/docs/restapi/user-management
    facebook https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow
    twitch https://dev.twitch.tv/docs/authentication/getting-tokens-oidc#oidc-authorization-code-flow
    """
    
    import settings
    
    
    def gen_oauth_scope(provider, scopes):
        if type(scopes) == str:
            pass
        elif type(scopes) == list:
            if provider == 'google':
                scopes = ' '.join(scopes)
            elif provider == 'kakao':
                scopes = ','.join(scopes)
            elif provider == 'twitch':
                scopes = ''  # FIXME
            else:
                scopes = ''.join(scopes)
        return scopes
    
    
    oauth_config = {
        'google': {
            'auth_uri': 'https://accounts.google.com/o/oauth2/auth',
            'token_uri': 'https://oauth2.googleapis.com/token',
            'me_uri': 'https://www.googleapis.com/oauth2/v1/userinfo',
            'auth_params': {
                'state': '',
                'redirect_uri': '',
                'client_id': settings.google_client_id,
                'scope': gen_oauth_scope('google', ['https://www.googleapis.com/auth/userinfo.profile',
                                                    'https://www.googleapis.com/auth/userinfo.email',
                                                    # 'https://www.googleapis.com/auth/youtube.force-ssl',
                                                    # 'https://www.googleapis.com/auth/drive.metadata.readonly',
                                                    ]),
                'access_type': 'offline',
                'include_granted_scopes': 'true',
                'response_type': 'code'
            },
            'token_params': {
                'code': '', 'scope': '', 'state': '',  # from request.args
                'redirect_uri': '',
                'client_id': settings.google_client_id,
                'client_secret': settings.google_client_secret,
                'grant_type': 'authorization_code'
            }
        },
        'kakao': {
            'auth_uri': 'https://kauth.kakao.com/oauth/authorize',
            'token_uri': 'https://kauth.kakao.com/oauth/token',
            'me_uri': 'https://kapi.kakao.com/v1/user/me',
            'auth_params': {
                'state': '',
                'redirect_uri': '',
                'client_id': settings.kakao_client_id,
                'response_type': 'code',
                'encode_state': 1,
            },
            'token_params': {
                'code': '',
                'redirect_uri': '',
                'client_id': settings.kakao_client_id,
                'client_secret': settings.kakao_client_secret,
                'grant_type': 'authorization_code',
            }
        },
        'naver': {
            'auth_uri': 'https://nid.naver.com/oauth2.0/authorize',
            'token_uri': 'https://nid.naver.com/oauth2.0/token',
            'me_uri': 'https://openapi.naver.com/v1/nid/me',
            'auth_params': {
                'scope': gen_oauth_scope('naver', ''),
                'redirect_uri': '',
                'client_id': settings.naver_client_id,
                'state': '',
                'response_type': 'code',
            },
            'token_params': {
                'code': '', 'state': '',
                'client_id': settings.naver_client_id,
                'client_secret': settings.naver_client_secret,
                'grant_type': 'authorization_code',
            }
        },
        'facebook': {
            'auth_uri': 'https://graph.facebook.com/oauth/authorize',
            'token_uri': 'https://graph.facebook.com/oauth/access_token',
            'me_uri': 'https://graph.facebook.com/me',
            'auth_params': {
                'state': '',
                'redirect_uri': '',
                'client_id': settings.facebook_client_id,
                'scope': gen_oauth_scope('facebook', []),
                'response_type': 'code',
            },
            'token_params': {
                'code': '', 'scope': '', 'state': '',
                'redirect_uri': '',
                'client_id': settings.facebook_client_id,
                'client_secret': settings.facebook_client_secret,
                'grant_type': 'authorization_code',
            }
        },
        'twitch': {
            'auth_uri': 'https://id.twitch.tv/oauth2/authorize',
            'token_uri': 'https://id.twitch.tv/oauth2/token',
            'me_uri': '',
            'auth_params': {
                'state': '',
                'redirect_uri': '',
                'client_id': settings.twitch_client_id,
                'scope': gen_oauth_scope('twitch', []),
                'response_type': 'code',
            },
            'token_params': {
                'code': '', 'scope': '', 'state': '',
                'redirect_uri': '',
                'client_id': settings.twitch_client_id,
                'client_secret': settings.twitch_client_secret,
                'grant_type': 'authorization_code',
            }
        }
    }
    \n`, `# https://github.com/a2tt/Flask-Sqlalchemy-Admin-Sample/blob/main/project/views/admin.py
    import json
import re
import functools

from flask import Blueprint, g, request, current_app, redirect, url_for, \
    render_template, abort, flash, session

from project.models.admin import *

from project.utils import *

import settings

bp = Blueprint('admin', __name__, template_folder='../templates', static_folder='static')


def super_user_required(func):
    @functools.wraps(func)
    def decorated(*args, **kwargs):
        user_id = session.get('user_id')
        if user_id:
            user = db.session.query(User).get(user_id)
            g.current_user = user
            if user and user.role in [User.SUPERUSER]:
                return func(*args, **kwargs)
            else:
                flash('권한이 없습니다.', 'warning')
                return '<script>window.history.back();</script>'
        return func(*args, **kwargs)

    return decorated


@bp.before_request
def admin_required():
    g.current_user = None
    return  # FIXME
    user_id = session.get('user_id')
    if not user_id:
        session['next'] = request.url
        return redirect(url_for('user.login'))
    user = db.session.query(User).get(user_id)
    if user and user.role in User.ADMINS:
        g.current_user = user
    else:
        abort(404)


@bp.before_request
def update_view_auth():
    return  # FIXME
    view = request.endpoint.replace(f'{request.blueprint}.', '')
    if settings.STAGE == 'production':
        if view.endswith('_update') and request.method in ['POST', 'PUT', 'DELETE']:
            idx = view.rindex('_update')
            model_name = snake_to_camel(view[:idx]) + 'Admin'
            model = globals()[model_name]
            if g.current_user is None:  # 왜??
                session['next'] = request.url
                return redirect(url_for('user.login'))
            if g.current_user.role not in model.edit_role:
                flash('권한이 부족합니다.', 'error')
                return redirect(request.url.replace('update', 'detail'))


@bp.before_request
def logging():
    if settings.STAGE == 'production':
        if request.method == 'POST' or (request.endpoint.endswith('_list') and not request.args.get('page')):
            log = AdminAccessLog(user_id=g.current_user.id if g.current_user else 0,
                                 endpoint=request.endpoint,
                                 args=json.dumps(dict(request.args)),
                                 form=json.dumps(dict(request.form)))
            db.session.add(log)
            db.session.commit()


@bp.before_request
def inject_stage():
    g.stage = settings.STAGE


def get_py_type(column):
    type_ = type(column.type)
    if type_ == Integer:
        return 'int'
    elif type_ == Float:
        return 'float'
    elif type_ == Boolean:
        return 'bool'
    # elif type_ == Enum:
    #     return 'enum'
    else:
        return 'str'


def calc_wide(fields):
    wide = int(16 / len(fields))
    map_ = {
        1: 'one', 2: 'two', 3: 'three', 4: 'four',
        5: 'five', 6: 'six', 7: 'seven', 8: 'eight',
        9: 'nine', 10: 'ten', 11: 'eleven', 12: 'twelve',
        13: 'thirteen', 14: 'fourteen', 15: 'fifteen', 16: 'sixteen',
    }
    return map_.get(wide)


@bp.context_processor
def admin_context_processor():
    return {'getattr': getattr,
            'py_type': get_py_type,
            'models': models,
            'calc_wide': calc_wide,
            }


@bp.route('/')
def index():
    return redirect(url_for('admin.user_list'))


def manage_model(model):
    def wrapper(func):
        @functools.wraps(func)
        def decorated_function(*args, **kwargs):
            try:
                model.init()
                search = request.args.get('search')

                page = int(request.args.get('page', 1))  # common
                pp = int(request.args.get('pp', model.per_page))  # common
                paginator = Paginator(model.num_rows(), page, pp)  # common

                if not search:  # 그냥
                    q_key = request.args.get('q_key', None)
                    q = request.args.get('q', None)
                    items = model.pagination(page, pp, q_key, q)  # normal query
                elif search == 'sort':
                    items = model.sort_pagination(page, pp, dict(request.args))
                elif search == 'filter':
                    items = model.filter_pagination(page, pp, dict(request.args))
                else:
                    items = models.pagination(page, pp)

                keys = model.keys
                display_keys = model.list_display
                search_keys = model.search_keys
                sort_keys = model.sort_keys
                filter_keys = model.filter_keys

                return render_template('admin/default/item_list.html',
                                       model=model,
                                       model_name=model.table_name(),
                                       items=items,
                                       keys=keys, display_keys=display_keys,
                                       search_keys=search_keys, sort_keys=sort_keys, filter_keys=filter_keys,
                                       page=page, paginator=paginator)
            except Exception as e:
                db.session.rollback()
                current_app.logger.exception(e)
                abort(500)

        return decorated_function

    return wrapper


def list_view_generator(model):
    @manage_model(model)
    def view():
        pass

    return view


def detail_view_generator(model):
    def view(p_key):
        model.init()
        item = db.session.query(model).get(p_key)
        for key, widget in item.Meta.widgets.items():
            widget.value = getattr(item, key)

        return render_template(f'admin/default/detail_view.html',
                               model=model, item=item)

    return view


def update_view_generator(model):
    def view(p_key):
        model.init()
        item = db.session.query(model).get(p_key)

        data = dict(request.form)
        for key, value in data.items():
            if key not in model.list_editable:  # 수정 가능한 것들만
                continue
            type_ = model.column_type(key, format_='py')
            if type_ == 'bool':
                value = True if value in [1, '1', 'true'] else False
            if value in ['', 'None']:
                if model.column_is_nullable(key):
                    value = None
                else:
                    value = model.get_default_value(key)

            setattr(item, key, value)

        db.session.add(item)
        db.session.commit()

        flash('성공', 'success')
        return redirect(url_for(f'admin.{model.table_name()}_detail', p_key=p_key))

    return view


def create_view_generator(model):
    @super_user_required
    def view():
        if request.method == 'GET':
            model.init()
            return render_template('admin/default/create_view.html',
                                   model=model)
        else:
            try:
                data = dict(request.form)
                for key, value in data.items():
                    type_ = model.column_type(key, format_='py')
                    if type_ == 'bool':
                        data[key] = True if value in [1, '1', 'true'] else False
                    if value in ['', 'None']:
                        if model.column_is_nullable(key):
                            data[key] = None
                        else:
                            data[key] = model.get_default_value(key)
                item = model(**data)
                db.session.add(item)
                db.session.commit()

                p_key = getattr(item, item.p_key)
                flash('성공', 'success')
                return redirect(url_for(f'admin.{model.table_name()}_detail', p_key=p_key))
            except Exception as e:
                flash(re.sub('''[\"\']+''', '\`', str(e).replace('\n', ' ')), 'error')
                return '''<script>window.history.back();</script>'''

    return view


# list view (모든 admin model 통합)
for category, models_ in models.items():
    for model in models_:
        bp.add_url_rule(f'/{model.table_name()}', f'{model.table_name()}_list', list_view_generator(model))
for model in hidden_models:
    bp.add_url_rule(f'/{model.table_name()}', f'{model.table_name()}_list', list_view_generator(model))

# detail view
for model in auto_detail_views:
    bp.add_url_rule(f'/{model.table_name()}/<p_key>/detail', f'{model.table_name()}_detail',
                    detail_view_generator(model))

# update view
for model in auto_update_views:
    bp.add_url_rule(f'/{model.table_name()}/<p_key>/update', f'{model.table_name()}_update',
                    update_view_generator(model), methods=['POST'])

# create view
for model in auto_create_views:
    bp.add_url_rule(f'/{model.table_name()}/create', f'{model.table_name()}_create',
                    create_view_generator(model), methods=['GET', 'POST'])


@bp.route('/user/<p_key>/detail')
def user_detail(p_key):
    model = UserAdmin
    model.init()
    item = db.session.query(model).get(p_key)
    for key, widget in item.Meta.widgets.items():
        widget.value = getattr(item, key)
    return render_template(f'admin/models/user.html',
                           model=model, item=item)


@bp.route('/management')
def manage():
    return 'management'
    \n`, `# https://github.com/a2tt/fast-ssh-relay/blob/main/server/ssh.py 
from __future__ import annotations

import json
import asyncio
from enum import Enum
from typing import Dict, Set, Awaitable
from collections import defaultdict

import paramiko
from paramiko import (
    SSHClient,
    AutoAddPolicy,
)
from paramiko.channel import Channel
from fastapi import WebSocket, WebSocketDisconnect
from starlette.websockets import WebSocketState

from server.exceptions import SSHStopRetryException
from server.models import User, ConnectionInfo

MAX_SSH_CONNECTION = 5  # Maximum number of SSH connection per user
ssh_clients: Dict[str, Set[SSHWorker]] = defaultdict(set)  # (user-id, ip): {ssh-worker1, ...}


class WorkerStatus(Enum):
    DISCONNECTED = 0
    CONNECTING = 1  # Not used
    CONNECTED = 2


class Reason:
    SSH_TOO_MANY = 'You are trying to connection too many connection'
    SSH_AUTH_FAIL = 'Cannot connect to the SSH server. Authentication failed.'
    SSH_FAIL = 'Cannot connect to the SSH server.'
    SSH_DOWN = 'SSH server down'
    SSH_CHAN_CLOSE = 'SSH channel closed'

    SERVER_DOWN = 'Server down'  # Normally on KeyboardInterrupt
    WS_DISCONNECTED = 'Websocket disconnected'


class SSHWorker:
    """
    The websocket connection from clients can be disconnected unintentionally.
    Thus, it would be more comfortable to users to keep SSHWorker alive and recycle
    it for the next connection.
    TODO: delete idle instance after n seconds of disconnection, and remove from ssh_clients map.
    """

    BUF_SIZE = 32 * 1024

    def __init__(self, websocket: WebSocket, connection_info: ConnectionInfo, client: SSHClient):
        self.websocket: WebSocket = websocket
        self.connection_info: ConnectionInfo = connection_info

        self.client: SSHClient = client
        self.channel: Channel | None = None
        self.ssh_retry = 5
        self.set_ssh_channel()

        self.status: WorkerStatus = WorkerStatus.DISCONNECTED
        self.awaitable_recv_client: asyncio.tasks.Task | None = None
        self.awaitable_recv_ssh: asyncio.tasks.Task | None = None

    @property
    def is_connected(self) -> bool:
        return self.status == WorkerStatus.CONNECTED

    def set_ssh_channel(self):
        """
        Create paramiko.channel instance that might be closed in the middle
        of receiving messages
        """

        if not (self.channel is None or self.channel.closed):
            return

        try:
            self.channel = self.client.invoke_shell()
        except paramiko.SSHException:
            self.cleanup(Reason.SSH_DOWN, True)
            self.ssh_retry -= 1

            if self.ssh_retry < 0:
                raise SSHStopRetryException
            raise IOError

    def setup_recycle(self, websocket: WebSocket, connection_info: ConnectionInfo):
        """ setup variables for the next websocket user """

        self.websocket = websocket
        self.connection_info = connection_info
        self.channel.sendall(b'\f')

    async def run(self):
        self.set_awaitable_task(self.recv_from_client(), self.recv_from_ssh())

        try:
            await asyncio.gather(
                self.awaitable_recv_client,
                self.awaitable_recv_ssh,
            )
        except asyncio.CancelledError:
            return

    def set_awaitable_task(self, recv_client: Awaitable, recv_ssh: Awaitable):
        self.awaitable_recv_client = asyncio.create_task(recv_client)
        self.awaitable_recv_ssh = asyncio.create_task(recv_ssh)

    async def accept_websocket(self):
        await self.websocket.accept()
        self.status = WorkerStatus.CONNECTED

    async def cleanup(self, reason: str, send_close: bool):
        if send_close and self.websocket.application_state == WebSocketState.CONNECTED:
            data = {'event': 'CLOSE', 'reason': reason}
            await self.websocket.send_bytes(json.dumps(data).encode())
            await self.websocket.close()

        self.status = WorkerStatus.DISCONNECTED

    async def recv_from_client(self):
        """
        Receive message from the client(browser) and forward that messages to
        the SSH server
        """

        reason = ''
        send_close = True
        while self.is_connected:
            try:
                self.set_ssh_channel()

                # Receive from client
                data = await self.websocket.receive_text()
                print(f'from client ({self.connection_info})', data)

                # Forward to SSH server
                msg = json.loads(data)['data']
                self.channel.sendall(msg)
            except KeyboardInterrupt:
                reason = Reason.SERVER_DOWN
                break
            except IOError:
                continue
            except WebSocketDisconnect:
                reason = Reason.WS_DISCONNECTED
                send_close = False
                break
            except:
                break

        await self.cleanup(reason, send_close)
        if not self.awaitable_recv_ssh.done():
            self.awaitable_recv_ssh.cancel(reason)

    async def recv_from_ssh(self):
        """
        Receive message from SSH server and forward that messages to the
        client(browser)
        """

        reason = ''
        send_close = True
        while self.is_connected:
            await asyncio.sleep(0.01)
            try:
                self.set_ssh_channel()

                data = self.channel.recv(self.BUF_SIZE)
                if len(data) <= 0:
                    continue

                await self.websocket.send_bytes(data)
            except KeyboardInterrupt:
                reason = Reason.SERVER_DOWN
                break
            except (OSError, IOError):
                # including socket.timeout
                continue
            except WebSocketDisconnect:
                reason = Reason.WS_DISCONNECTED
                send_close = False
                break
            except:
                break

        await self.cleanup(reason, send_close)


def ssh_connect(
    websocket: WebSocket,
    user: User,
    hostname: str,
    username: str,
    password: str,
    port: int = 22
) -> SSHWorker:
    if len(ssh_clients[str(user)]) > MAX_SSH_CONNECTION:
        raise Exception(Reason.SSH_TOO_MANY)

    # When there is already connected ssh client disconnected with the user,
    # reuse that ssh client.
    connection_info = ConnectionInfo(user=user, ssh_user=username,
                                        src=websocket.client.host, dest=hostname,
                                        port=port)

    for worker in ssh_clients[connection_info.key]:
        if worker.status == WorkerStatus.DISCONNECTED:
            worker.setup_recycle(websocket, connection_info)
            return worker

    client = SSHClient()
    client.load_system_host_keys()
    client.set_missing_host_key_policy(AutoAddPolicy)

    try:
        client.connect(hostname=hostname,
                        username=username,
                        password=password,
                        port=port,
                        compress=True,
                        )

    except paramiko.AuthenticationException:
        raise Exception(Reason.SSH_AUTH_FAIL)
    except Exception as e:
        raise Exception(Reason.SSH_FAIL)

    ssh_worker = SSHWorker(websocket, connection_info, client)
    ssh_worker.channel.settimeout(0)

    ssh_clients[connection_info.key].add(ssh_worker)
    return ssh_worker
    \n`,
]